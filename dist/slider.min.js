angular.module("slider",[]).directive("slider",function(){function n(n,s,t){e(n,s,t)}function e(n,e,s){function t(e,s,t){function a(n,e){var s=(Math.abs(t-e),(t-g.x)/g.w);s*=100;var a={left:s+"%"};n.css(a)}function i(){t=t>=w.rX?w.rX-1:t,t=t<=g.x?g.x:t,a(d,w.lX);var e=(w.rX-t)/g.w;e*=100;var s=(t-g.x)/g.w;s*=100;var i={width:e+"%",left:s+"%"};g.bar.css(i),n.from=parseInt((t-g.x)/g.w*100*(n.max-n.min)/100)+parseInt(n.min),n.from=Math.max(n.min,n.from),n.$apply()}function r(){t=t<=w.lX?w.lX+1:t,t=t>=g.y?g.y:t,a(f,w.rX);var e=(t-w.lX)/g.w;e*=100;var s={width:e+"%"};g.bar.css(s),n.to=parseInt((t-g.x)/g.w*100*(n.max-n.min)/100)+parseInt(n.min),n.to=Math.min(n.to,n.max),n.$apply()}e=e||window.event;var o=e;if(w.drag){switch(s){case"left":i();break;case"right":r()}return o.setCapture&&this.setCapture(),!1}}function a(n){w.drag=!1,b&&b.releaseCapture&&b.releaseCapture()}function i(n){function e(n){if(n||s>w.rX)return X="right";if(s<w.lX)return X="left";if(s>w.lX&&s<w.rX){var e=(w.lX+w.rX)/2;return X=s>e?"right":"left"}}n=n||window.event,w={lX:v.single?g.x:u.offset().left,rX:c.offset().left,drag:!0,move:arguments[1]};var s=n.clientX,a=e(v.single);t(n,a,s)}function r(n){n&&e.find(".left-container").remove()}function o(n){var s=[];if(n[0])return void e.find(".sign-num, .min-num, .max-num").remove();n[1]&&(s.push(".min-num"),s.push(".max-num")),n[2]&&s.push(".sign-num");var t=s.join(", ");e.find(t).remove()}function l(){var n=v.from/v.sums*100+"%",e=v.to/v.sums*100+"%";d.css({left:n}),f.css({left:e}),p.css({left:n,width:(v.to-v.from)/v.sums*100+"%"})}var m=e.find(".slider-body"),d=e.find(".left-container"),f=e.find(".right-container"),u=(e.find(".slider-hander"),e.find(".slider-bar-from.slider-hander")),c=e.find(".slider-bar-to.slider-hander"),p=e.find(".slider-bar"),x=e.find(".slider-line"),h=(e.find(".sign-num.left"),e.find(".sign-num.right"),e.find(".min-num, .max-num"));d.data("type","left"),f.data("type","right");var g={x:x.offset().left,y:x.offset().left+x.width(),w:x.width(),bar:p};(!n.min||n.min<=0)&&(n.min=0),(!n.max||n.max<=0)&&(n.max=100),(!n.to||n.to<=0)&&(n.to=n.max),n.to>n.max&&(n.to=n.max),n.single||((!n.from||n.from<=0)&&(n.from=n.min),n.from>n.max&&(n.from=n.max)),n.single&&(n.from=0);var v={min:n.min,max:n.max,from:n.from,to:n.to,sums:n.max-n.min,single:"true"==n.single,hideText:"true"==n.hideText,hideMinMax:"true"==n.hideMinMax,hideFromTo:"true"==n.hideFromTo},w={},b=null,X=null;"onselectstart"in document&&angular.element(document).on("selectstart",".slider",function(n){return!1}),document.selection?document.selection.empty?document.selection.empty():document.selection=null:window.getSelection&&window.getSelection().removeAllRanges(),r(v.single),o([v.hideText,v.hideMinMax,v.hideFromTo]),l(),m.focus(function(n){var e=angular.element(this);e.addClass("active")}),m.blur(function(n){var e=angular.element(this);e.removeClass("active")}),h.on("mousedown",function(n){n.stopPropagation()}),m.on("mousedown",i),f.on("mousedown",function(n){X="right",i(n,!0),n.stopPropagation()}),d.on("mousedown",function(n){X="left",i(n,!0),n.stopPropagation()}),angular.element(document).on("mousemove.slider",function(n){var e=n.clientX,s=X;w.move&&t(n,s,e)}),angular.element(document).on("mouseup.slider",a)}return{restrict:"EA",link:n,scope:{min:"@",max:"@",from:"=",to:"=",single:"@",hideFromTo:"@",hideMinMax:"@",hideText:"@"},template:'<span class="slider slider-body" tabindex="0"> <span class="min-num" tabindex="-1"><span class="text">{{ min }}</span></span><span class="slider-line-before"></span><span class="slider-line"></span><span class="slider-line-after"></span><span class="max-num" tabindex="-1"><span class="text">{{ max }}</span></span><span class="slider-bar"></span><span class="left-container"><span class="sign-num left"><span class="text">{{ from }}</span></span><span class="slider-bar-from slider-hander"></span></span><span class="right-container"><span class="slider-bar-to slider-hander"></span><span class="sign-num right"><span class="text">{{ to }}</span></span></span></span>'}});