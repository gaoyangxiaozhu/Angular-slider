angular.module("slider",[]).directive("slider",function(){function n(n,a,s){e(n,a,s)}function e(n,e,a){function s(e,a,s){function r(n,e){var a=(Math.abs(s-e),(s-g.x)/g.w);a*=100;var r={left:a+"%"};n.css(r)}function t(){s=s>=v.rX?v.rX-1:s,s=s<=g.x?g.x:s,r(m,v.lX);var e=(v.rX-s)/g.w;e*=100;var a=(s-g.x)/g.w;a*=100;var t={width:e+"%",left:a+"%"};g.bar.css(t),n.from=parseInt((s-g.x)/g.w*100*(n.max-n.min)/100)+parseInt(n.min),n.from=Math.max(n.min,n.from),n.$apply()}function i(){s=s<=v.lX?v.lX+1:s,s=s>=g.y?g.y:s,r(d,v.rX);var e=(s-v.lX)/g.w;e*=100;var a={width:e+"%"};g.bar.css(a),n.to=parseInt((s-g.x)/g.w*100*(n.max-n.min)/100)+parseInt(n.min),n.to=Math.min(n.to,n.max),n.$apply()}if(e=e||window.event,v.drag){switch(a){case"left":t();break;case"right":i()}return w.setCapture&&this.setCapture(),!1}}function r(n){v.drag=!1,w&&w.releaseCapture&&w.releaseCapture()}function t(n){function e(n){if(n||r>v.rX)return X="right";if(r<v.lX)return X="left";if(r>v.lX&&r<v.rX){var e=(v.lX+v.rX)/2;return X=r>e?"right":"left"}}n=n||window.event;var a=angular.element(this);w=a,v={lX:h.single?g.x:c.offset().left,rX:u.offset().left,drag:!0};var r=n.clientX,t=e(h.single);s(n,t,r)}function i(n){n&&e.find(".left-container").remove()}function l(n){n&&e.find(".sign-num").remove()}function f(){var n=h.from/h.sums*100+"%",e=h.to/h.sums*100+"%";m.css({left:n}),d.css({left:e}),p.css({left:n,width:(h.to-h.from)/h.sums*100+"%"})}var o=e.find(".slider-body"),m=e.find(".left-container"),d=e.find(".right-container"),c=(e.find(".slider-hander"),e.find(".slider-bar-from.slider-hander")),u=e.find(".slider-bar-to.slider-hander"),p=e.find(".slider-bar"),x=e.find(".slider-line");e.find(".sign-num.left"),e.find(".sign-num.right");u.data("type","right"),c.data("type","left");var g={x:x.offset().left,y:x.offset().left+x.width(),w:x.width(),bar:p};(!n.min||n.min<=0)&&(n.min=0),(!n.max||n.max<=0)&&(n.max=100),(!n.to||n.to<=0)&&(n.to=n.max),n.to>n.max&&(n.to=n.max),n.single||((!n.from||n.from<=0)&&(n.from=n.min),n.from>n.max&&(n.from=n.max)),n.single&&(n.from=0);var h={min:n.min,max:n.max,from:n.from,to:n.to,sums:n.max-n.min,single:"false "==n.single,hideText:"true"==n.hideText},v={},w=null,X=null;i(h.single),l(h.hideText),f(),o.focus(function(n){var e=angular.element(this);e.addClass("active")}),o.blur(function(n){var e=angular.element(this);e.removeClass("active")}),o.on("mousedown",t),angular.element(document).on("mousemove.slider",function(n){var e=X,a=n.clientX;s(n,e,a)}),angular.element(document).on("mouseup.slider",r)}return{restrict:"EA",link:n,scope:{min:"@",max:"@",from:"=",to:"=",single:"@",hideText:"@"},template:'<span class="slider slider-body" tabindex="0"> <span class="slider-line-before"></span><span class="slider-line"></span><span class="slider-line-after"></span><span class="slider-bar"></span><span class="left-container"><span class="sign-num left"><span class="text">{{ from }}</span></span><span class="slider-bar-from slider-hander"></span></span><span class="right-container"><span class="slider-bar-to slider-hander"></span><span class="sign-num right"><span class="text">{{ to }}</span></span></span></span>'}});