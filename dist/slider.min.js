angular.module("slider",[]).directive("slider",function(){function n(n,s,a){e(n,s,a)}function e(n,e,s){function a(e,s,a){function i(n,e){var s=(Math.abs(a-e),(a-g.x)/g.w);s*=100;var i={left:s+"%"};n.css(i)}function t(){a=a>=w.rX?w.rX-1:a,a=a<=g.x?g.x:a,i(d,w.lX);var e=(w.rX-a)/g.w;e*=100;var s=(a-g.x)/g.w;s*=100;var t={width:e+"%",left:s+"%"};g.bar.css(t),n.from=parseInt((a-g.x)/g.w*100*(n.max-n.min)/100)+parseInt(n.min),n.from=Math.max(n.min,n.from),n.$apply()}function r(){a=a<=w.lX?w.lX+1:a,a=a>=g.y?g.y:a,i(f,w.rX);var e=(a-w.lX)/g.w;e*=100;var s={width:e+"%"};g.bar.css(s),n.to=parseInt((a-g.x)/g.w*100*(n.max-n.min)/100)+parseInt(n.min),n.to=Math.min(n.to,n.max),n.$apply()}e=e||window.event;var o=e;if(w.drag){switch(s){case"left":t();break;case"right":r()}return o.setCapture&&this.setCapture(),!1}}function i(n){w.drag=!1,X&&X.releaseCapture&&X.releaseCapture()}function t(n){function e(n){if(n||s>w.rX)return b="right";if(s<w.lX)return b="left";if(s>w.lX&&s<w.rX){var e=(w.lX+w.rX)/2;return b=s>e?"right":"left"}}n=n||window.event,w={lX:v.single?g.x:u.offset().left,rX:c.offset().left,drag:!0,move:arguments[1]};var s=n.clientX,i=e(v.single);a(n,i,s)}function r(n){n&&e.find(".left-container").remove()}function o(n){var s=[];if(n[0])return void e.find(".sign-num, .min-num, .max-num").remove();n[1]&&(s.push(".min-num"),s.push(".max-num")),n[2]&&s.push(".sign-num");var a=s.join(", ");e.find(a).remove()}function l(){var n=v.from/v.sums*100+"%",e=v.to/v.sums*100+"%";d.css({left:n}),f.css({left:e}),p.css({left:n,width:(v.to-v.from)/v.sums*100+"%"})}var m=e.find(".slider-body"),d=e.find(".left-container"),f=e.find(".right-container"),u=(e.find(".slider-hander"),e.find(".slider-bar-from.slider-hander")),c=e.find(".slider-bar-to.slider-hander"),p=e.find(".slider-bar"),x=e.find(".slider-line"),h=(e.find(".sign-num.left"),e.find(".sign-num.right"),e.find(".min-num, .max-num"));d.data("type","left"),f.data("type","right");var g={x:x.offset().left,y:x.offset().left+x.width(),w:x.width(),bar:p};(!n.min||n.min<=0)&&(n.min=0),(!n.max||n.max<=0)&&(n.max=100),(!n.to||n.to<=0)&&(n.to=n.max),n.to>n.max&&(n.to=n.max),n.single||((!n.from||n.from<=0)&&(n.from=n.min),n.from>n.max&&(n.from=n.max)),n.single&&(n.from=0);var v={min:n.min,max:n.max,from:n.from,to:n.to,sums:n.max-n.min,single:"true"==n.single,hideText:"true"==n.hideText,hideMinMax:"true"==n.hideMinMax,hideFromTo:"true"==n.hideFromTo},w={},X=null,b=null;document.selection?document.selection.empty?document.selection.empty():document.selection=null:window.getSelection&&window.getSelection().removeAllRanges(),r(v.single),o([v.hideText,v.hideMinMax,v.hideFromTo]),l(),m.focus(function(n){var e=angular.element(this);e.addClass("active")}),m.blur(function(n){var e=angular.element(this);e.removeClass("active")}),h.on("mousedown",function(n){n.stopPropagation()}),m.on("mousedown",t),f.on("mousedown",function(n){b="right",t(n,!0),n.stopPropagation()}),d.on("mousedown",function(n){b="left",t(n,!0),n.stopPropagation()}),angular.element(document).on("mousemove.slider",function(n){var e=n.clientX,s=b;w.move&&a(n,s,e)}),angular.element(document).on("mouseup.slider",i)}return{restrict:"EA",link:n,scope:{min:"@",max:"@",from:"=",to:"=",single:"@",hideFromTo:"@",hideMinMax:"@",hideText:"@"},template:'<span class="slider slider-body" tabindex="0"> <span class="min-num"><span class="text">{{ min }}</span></span><span class="slider-line-before"></span><span class="slider-line"></span><span class="slider-line-after"></span><span class="max-num"><span class="text">{{ max }}</span></span><span class="slider-bar"></span><span class="left-container"><span class="sign-num left"><span class="text">{{ from }}</span></span><span class="slider-bar-from slider-hander"></span></span><span class="right-container"><span class="slider-bar-to slider-hander"></span><span class="sign-num right"><span class="text">{{ to }}</span></span></span></span>'}});